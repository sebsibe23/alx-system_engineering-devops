#!/usr/bin/env bash

# Get the process IDs of Gunicorn workers
worker_pids=$(ps auxf | grep gunicorn | grep -v grep | awk '{print $2}')

# Display the current Gunicorn processes
echo "Current Gunicorn processes:"
ps auxf | grep gunicorn | grep -v grep

# Send a graceful reload signal to each worker
for pid in $worker_pids; do
    echo "Reloading Gunicorn worker with PID $pid"
    kill -HUP $pid
done

# Wait for the workers to restart
sleep 2

# Display the updated Gunicorn processes
echo "Updated Gunicorn processes:"
ps auxf | grep gunicorn | grep -v grep
